<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Count it down</title>
    <style type="text/css">
      body {
        font-family:"Lucida Grande","Arial Unicode MS", sans-serif;
        text-align:center;
        margin:0px;
        padding:0px;
      }
      ol, li, h1, h3, h4, header {
        padding:0;
        margin:0;
        position:relative;
        list-style-type:none;
      }
      h1 { 
        color:#3b3314;
        text-shadow: 0px 1px 0px #938346;
        font-size:40px;
      }
      h3 {
        color:#544a20;
        text-shadow: 0px 1px 0px #938346;
        font-size:16px;
      }
      h4 {
        margin-bottom:5px;
        color:#484124;
      }
      ol li li {
        background:#231F20;
        position:relative;
      }
      p {
        color:#292c2c;
        font-size:15px;
        position:relative;
        text-shadow:0px 1px 0px #000;
      }
      form {
        width:700px;
        margin:auto;
      }
      form p {
        margin-top:-35px;
        padding:20px 0 5px;
        z-index:1;
        position:relative;
        color:#FFF;
        opacity:0.5;
      }
      form .error {
        background:#f6e660;
        color:#222;
        text-shadow:none;
      }
      input[type=text]:hover {
        background:#eee;
      }
      input {
        clear:both;
        display:block;
        margin:auto;
        margin-bottom:20px;
        text-align:center;
        width:100%;
        font-size:30px;
        padding:10px 0;
        border:1px solid #555;
        position:relative;
        z-index:2;
        color:#444;
      }
      input.date {
        font-size:20px;
      }
      .section, .sections {
        position:relative;
      }

      

      
      /* Clock Form */      
      .previous {
        background:#333;
        color:#FFF;
        padding:15px;
        color:#CCC;
        margin:auto;
        opacity:1;
      }
      #previous_clock {
        color:#ba3b1d;
      }
      #form .wrapper {
        width:800px;
        margin:auto;
      }
      #form .left {
        width:250px;
        float:left;
        text-align:left;
      }
      #form h1 {
        color:#FFF;
        margin:0 0 20px;
        text-shadow: 1px 2px 0px #000;
        font-size:50px;
      }
      #form h2 {
        font-size:17px;
        color:#ccc;
      }
      #form form {
        width:450px;
        float:right;
      }
      .button {
        color:#f5baba;
        text-shadow:0px -1px 0px #000;
        border:none;
        border-top:2px solid #AAA;
        border-bottom:1px solid #333;
        margin-top:40px;
        font-size:20px;
        text-decoration:none;
      }
      .button.small {
        padding:5px 9px;
        font-size:13px;
        border-width:1px;
      }
      
      /* Countdown Clock */
      .digit, .colon {
        text-align:center;
        font-size:120px;
      }
      .digit, .colon, .overlay {
        height:140px;
      }
      .colon {
        color:#FFF;
        width:50px;
      }
      .digit {
        overflow:hidden;
        float:right;
        background:#000;
      }
      .numbers {
        width:83px;
        color:#CCC;
        background:#000;
      }
      .numbers li {
        text-shadow:0px -2px 1px #FFF;
      }
      .numbers.red li {
        text-shadow:0px -2px 1px #dc6a6a;
      }
      .colon, .numbers {
        border-right:1px solid #333;
        border-right:1px solid #333;
      }
      .red {
        color:#e63333;
      }
      .colon,
      .unit {
        float:left;
        position:relative;
        background:#000;
      }
      .unit h3 {
        text-align:right;
        position:absolute;
        top:-30px;        
      }
      .clock {
        border-top:6px solid #433b19;
        border-bottom:6px solid #e6daa3;
        border-left:6px solid #786d40;
        border-right:6px solid #786d40;
        margin:auto;
        width:825px;
        margin-bottom:20px;
        margin-top:50px;
      }
      #clock {
        position:relative;
      }
      #frame {
        width:100%;
        position:relative;
        overflow:hidden;
      }
      .credit {
        position:absolute;
        top:-5px;
        left:-30px;
        width:220px;
        height:12px;
        z-index:100;
        font-size:11px;
        opacity:0.3;
        color:#000;
      }
      .credit a {
        color:#000;
      }
      
      .controls {
        position:absolute;
        top:10px;
        right:5px;
        z-index:10;
      }
      .controls a {
        padding:4px 8px;
        background:#000;
        opacity:.4;
        color:#FFF;
        border-bottom:1px solid #b1a679;
        border-left:1px solid #786d40;
        text-decoration:none;
      }
      .controls a:hover {
        background:#CCC;
        color:#000;
      }
      .sharing {
        bottom:0px;
        position:absolute;
        width:100%;
        background:#7d7244;
        padding:10px 10px 10px;
      }
      .sharing h4,
      .sharing .url {
        opacity:.8;
        font-size:12px;
      }
      .sharing .url:hover {
        opacity:1;
      }
      .sharing h4 { 
        color:#000;
        font-size:14px;
      }
      .sharing .url {
        background:#c8c1a2;
        padding:5px 9px;
        border-top:1px solid #eee9d1;
        font-weight:bold;
        color:#222;
      }
      
      
      
      form p {
        background: linear-gradient(left top, #343f56, #888);
        background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#343f56), to(#888));
        background: -moz-linear-gradient(center top, #343f56, #888);
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#343f56', endColorstr='#888');
        
        border-radius:4px;
        -moz-border-radius:4px;
      }
      p.previous {
        border-radius:10px;
        -moz-border-radius:10px;
      }
      input {
        background: linear-gradient(left top, #bbb, #eee);
        background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#bbb), to(#eee));
        background: -moz-linear-gradient(center top, #bbb, #eee);
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#bbb', endColorstr='#eee');
        
        border-radius:7px;
        -moz-border-radius:7px;
      }
      .button {
        background: linear-gradient(left top, #ba3b1d, #a22c11);
        background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#ba3b1d), to(#a22c11));
        background: -moz-linear-gradient(center top, #ba3b1d, #a22c11);
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ba3b1d', endColorstr='#a22c11');
      }
      .button:hover {
        background: linear-gradient(left top, #ff0000, #a22c11);
        background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#ff0000), to(#a22c11));
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ff0000', endColorstr='#a22c11');
      }
      .button.small {
        border-radius:5px;
        -moz-border-radius:5px;
      }
      #form {
        background: linear-gradient(left top, #30445c, #555);
        background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#30445c), to(#555));
        background: -moz-linear-gradient(center top, #30445c, #555);
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#30445c', endColorstr='#555');
      }
      #clock {
        background: linear-gradient(left top, #695e2e, #a49764);
        background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#695e2e), to(#a49764));
        background: -moz-linear-gradient(center top, #695e2e, #a49764);
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#695e2e', endColorstr='#a49764');
      }
      .overlay {
        -webkit-mask-image: -webkit-gradient(linear, left bottom, left top, from(rgba(0,0,0,1)), to(rgba(0,0,0,0.2)));	
      }
      
    </style>
  </head>
  <body>
    <div id="frame">
      <p class="credit"><a href="mailto:roy.kolak@gmail.com">Roy Kolak</a>, Copyright 2010</p>
      <div id="sections" class="sections">
        <div id="form" class="section">
          <div class="wrapper">
            <div class="left">
              <h1>Countdown to Zero</h1><h2>Your assignment is due, your friends are visiting, your trip is approaching<br/><br/> Count it down.</h2>
            </div>
            <form>
              <input type="text" id="title" placeholder="Clock title" />
              <p>The title of your countdown clock.</p>
              <input type="text" id="date" class="date" placeholder="Month, 19 2010 5:10pm"/>
              <p class="date_info">Your date will be parsed, be friendly!</p>
              <p class="parse_error error">Don't know that date. Maybe try another one?</p>
              <p class="diff_error error">That is too far in the future! Max countdown is 99 days.</p>
              <input type="submit" id="load" class="button" value="Start" />
              <p id="previous" class="previous">Psst! <strong id="previous_clock"></strong> is still running. <a href="#" id="resume" class="button small">Resume</a></p>
            </form>
            <div style="clear:both"></div>
          </div>
        </div>
        <div id="clock" class="section">
          <div class="wrapper">
            <audio id="tick" src="tick.mp3" loop="loop"></audio>
            <div class="controls">
              <a href="#" id="toggle_sound" class="sound">Toggle sound</a>
              <a href="#" id="back">New clock</a>
            </div>          
            <h1 id="clock_title"></h1>
            <div class="countdown_clock">
              <div class="clock">
                <div class="unit first">
                  <h3>Days</h3>
                  <div class="overlay">
                    <ol id="days">
                      <li class="digit digit_two">
                        <ol class="numbers">
                          <li>0</li><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>0</li>
                        </ol>
                      </li>
                      <li class="digit digit_one">
                        <ol class="numbers">
                          <li>0</li><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>0</li>
                        </ol>
                      </li>
                    </ol>
                  </div>
                </div>
                <div class="colon">:</div>
                <div class="unit">
                  <h3>Hours</h3>
                  <div class="overlay">
                    <ol id="hours">
                      <li class="digit digit_two">
                        <ol class="numbers">
                          <li>0</li><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>0</li>
                        </ol>
                      </li>
                      <li class="digit digit_one">
                        <ol class="numbers">
                          <li>0</li><li>1</li><li>2</li><li>0</li>
                        </ol>
                      </li>
                    </ol>
                  </div>
                </div>
                <div class="colon">:</div>
                <div class="unit">
                  <h3>Minutes</h3>
                  <div class="overlay">
                    <ol id="minutes">
                      <li class="digit digit_two">
                        <ol class="numbers">
                        <li>0</li><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>0</li>
                        </ol>
                      </li>
                      <li class="digit digit_one">
                        <ol class="numbers">
                          <li>0</li><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>0</li>
                        </ol>
                      </li>
                    </ol>
                  </div>
                </div>
                <div class="colon">:</div>
                <div class="unit last">
                  <h3>Seconds</h3>
                  <div class="overlay">
                    <ol id="seconds">
                      <li class="digit digit_two">
                        <ol class="numbers red">
                        <li>0</li><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>0</li>
                        </ol>
                      </li>
                      <li class="digit digit_one">
                        <ol class="numbers">
                          <li>0</li><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>0</li>
                        </ol>
                      </li>
                    </ol>
                  </div>
                </div>
                <div style="clear:both"></div>
              </div>
            </div>
            <h3 id="end_date"></h3>
            <div class="sharing">
              <h4>Share this countdown: <a href="#" id="url" class="url"></a></h4>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="scripts">
      <script src="javascripts/jquery.js"></script>
      <script src="javascripts/tested.js"></script>
      <script>
        (function($) {
          $.urlParam = function(name){
            var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(window.location.href);
            return (results != null ? unescape(results[1]) : null);
          }

           audio = document.getElementsByTagName("audio")[0],
              db = localStorage,
              clock = null,
              load = new Load();

          if(db.sound == undefined)
            db.sound = "1";

          $('.wrapper').css({ paddingTop:$(window).height() / 4 });
          $('.section, #frame').height($(window).height());


          $('#load').click(function(ev) {
            ev.preventDefault();
            var title = $('#title').val() || $('#title').attr('placeholder');
            var date = $('#date').val() || $('#date').attr('placeholder');
            
            if(new DateValidator(date).validate()) {
              load.clock(title, date);
            }
          });
          
          $('#resume').click(function(ev) {
            ev.preventDefault();
            load.clock(db.title, db.date);
          });

          $('#back').click(function(ev) {
            ev.preventDefault();
            load.form();
          });

          $('#toggle_sound').click(function(ev) {
            ev.preventDefault();
            toggleSound();
          });
           
          load.form();
          
          function toggleSound() {
            db.sound = (db.sound == "1" ? "0" : "1");
            if(db.sound == "0") {
              audio.pause();
            }
          }
          
          function Load() {
            return {
              clock: function(title, date, duration_override) {
                var duration = 500;
                if(typeof(duration_override) != 'undefined') {
                  duration = duration_override;
                }
                $('#end_date').text(date.toLocaleString());
                $('#clock_title').text(title);
                var url = window.location.href.replace(window.location.search, '') + '?title=' + title + '&date=' + date;
                $('#url').text(url).attr('href', url);

                $('#sections').animate({top: -$('.section').height() }, {
                  duration:duration,
                  complete: function() {
                    clock = new Clock(title, date);
                    clock.start();
                  }
                });
              },
              form: function() {
                $('#form').css({ visibility: 'visible' });
                $('#sections').animate({top:0 });
                $('input[type=text]').val('');
                if($.urlParam('title') != null) {
                  $('#title').val($.urlParam('title'));
                  $('#date').val($.urlParam('date'));
                } else {
                  $('#date').attr('placeholder', "November 5, 2010 13:00");
                }
                $('.date_info').show();
                $('.error').hide();
                if(db.title != undefined) {
                  $('#previous_clock').text(db.title);
                  $('#previous').show();
                } else {
                  $('#previous').hide();
                }
                clock.stop()
                clock.reset();
              }
            }
          }
        })($);
      </script>
    </div>
  </body>
</html>
